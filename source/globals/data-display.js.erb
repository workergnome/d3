// Format Data
var dataElement = document.getElementById("data-display");
if (data) {
  dataElement.innerHTML = "var data = " + JSON.stringify(data, null, '  ');
  hljs.highlightBlock(dataElement);
} else {
  dataElement.parentNode.removeChild(dataElement);  
}

// Format Code
var xmlhttp= new XMLHttpRequest();
xmlhttp.onreadystatechange = function() {
    if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
        var code = document.getElementById("code-display");
        code.innerHTML = xmlhttp.responseText;
        hljs.highlightBlock(code);

        var fake_js = "<%= init_code %>\n";
        fake_js += "data = " + JSON.stringify(data, null, '  ') + ";\n\n";
        fake_js += xmlhttp.responseText;

        var codepen = {
          "title": document.title,
          "editors": "001",
          "layout":  "right",
          "html":    "<div id='visualization'>\n\t<svg width='100%' height='100%'></svg>\n</div>",
          "css":     "body {background-color: #ccc;} #visualization {margin: 50px; width: 500px; height: 400px; border-radius: 4px; border: 1px solid #eee; background-color: #fff; }",
          "js":      fake_js,
          "js_external": "https://d3js.org/d3.v4.js"
        }
        var codepen_json = JSON.stringify(codepen);
        document.getElementById("codepen_submit").setAttribute("value", codepen_json);
    }
}
xmlhttp.open("GET", "code.js", true);
xmlhttp.send();

